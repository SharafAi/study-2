<%- include('./partials/head') %>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

  <!-- Header -->
  <%- include('./partials/header') %>

  <!-- Signup Form Section -->
  <main class="flex-grow flex justify-center items-center py-6 px-4 min-h-[calc(100vh-80px)]">

    <div class="w-full max-w-3xl bg-white border-2 border-blue-400 rounded-2xl shadow-xl p-6 flex flex-col md:flex-row gap-6 h-auto">

      <!-- Left side: Form Fields -->
      <div class="flex-1 flex flex-col justify-between h-full w-full md:w-auto">

        <!-- Heading -->
        <div class="mb-4">
          <h1 class="text-3xl font-bold text-purple-700 text-center md:text-left mb-1">
            Create Your Account
          </h1>
          <p class="text-gray-500 text-center md:text-left text-sm">
            Fill in your details to create your account.
          </p>
        </div>

        <!-- Map errors to fields for visual feedback -->
        <% 
          let errorFields = [];
          if (errors && errors.length > 0) {
            errors.forEach(err => {
              const msg = err.toLowerCase();
              if (msg.includes('first name')) errorFields.push('firstname');
              if (msg.includes('last name')) errorFields.push('lastname');
              if (msg.includes('email')) errorFields.push('email');
              if (msg.includes('password must') || msg.includes('passwords do not match')) {
                if (msg.includes('passwords do not match')) errorFields.push('confirmPassword');
                else errorFields.push('password');
              }
              if (msg.includes('user type')) errorFields.push('usertype');
              if (msg.includes('terms')) errorFields.push('terms');
            });
          }
        %>

        <!-- Form -->
        <form action="/signup" method="POST" class="space-y-4 w-full">

          <!-- Error Messages -->
          <% if (errors && errors.length > 0) { %>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-3">
              <ul class="list-disc list-inside">
                <% errors.forEach(function(error) { %>
                  <li><%= error %></li>
                <% }); %>
              </ul>
            </div>
          <% } %>

          <!-- First Name & Last Name Row -->
          <div class="flex gap-4">
            <div class="flex-1">
              <label class="block text-gray-700 font-semibold mb-1">First Name</label>
              <input 
                type="text" 
                name="firstname" 
                placeholder="First Name"
                value="<%= oldInput.firstname || '' %>"
                class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400
                       <%= errorFields.includes('firstname') ? ' border-red-500 bg-red-50' : ' border-gray-300' %>"
                required 
              />
            </div>
            <div class="flex-1">
              <label class="block text-gray-700 font-semibold mb-1">Last Name</label>
              <input 
                type="text" 
                name="lastname" 
                placeholder="Last Name"
                value="<%= oldInput.lastname || '' %>"
                class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400
                       <%= errorFields.includes('lastname') ? ' border-red-500 bg-red-50' : ' border-gray-300' %>"
                required 
              />
            </div>
          </div>

          <!-- Email -->
          <div>
            <label class="block text-gray-700 font-semibold mb-1">Email</label>
            <input 
              type="email" 
              name="email" 
              placeholder="Enter your email"
              value="<%= oldInput.email || '' %>"
              class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400
                     <%= errorFields.includes('email') ? ' border-red-500 bg-red-50' : ' border-gray-300' %>"
              required 
            />
          </div>

          <!-- Password & Confirm Password Row -->
          <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
              <label class="block text-gray-700 font-semibold mb-1">Password</label>
              <input type="password" 
                     name="password" 
                     id="password"
                     placeholder="Enter your password"
                     value="<%= oldInput.password || '' %>"
                     class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400
                            <%= errorFields.includes('password') ? ' border-red-500 bg-red-50' : ' border-gray-300' %>"
                     required 
                     oninput="toggleConfirmPassword()" />
            </div>

            <div class="flex-1">
              <label class="block text-gray-700 font-semibold mb-1">Confirm Password</label>
              <input type="password" 
                     name="confirmPassword" 
                     id="confirmPassword"
                     placeholder="Re-enter your password"
                     value="<%= oldInput.confirmPassword || '' %>"
                     class="w-full p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400
                            <%= errorFields.includes('confirmPassword') ? ' border-red-500 bg-red-50' : ' border-gray-300' %>"
                     required
                     disabled />
            </div>
          </div>

          <script>
            function toggleConfirmPassword() {
              const password = document.getElementById("password").value.trim();
              const confirmPassword = document.getElementById("confirmPassword");
              confirmPassword.disabled = password === "";
            }
            document.addEventListener("DOMContentLoaded", toggleConfirmPassword);
          </script>

          <!-- User Type -->
          <div class="flex justify-center md:justify-start space-x-6 mt-2">
            <label class="flex items-center space-x-2 text-gray-700">
              <input 
                type="radio" 
                name="usertype" 
                value="guest" 
                class="accent-blue-500"
                <%= oldInput.usertype === 'guest' || !oldInput.usertype ? 'checked' : '' %> 
              />
              <span>Guest</span>
            </label>
            <label class="flex items-center space-x-2 text-gray-700">
              <input 
                type="radio" 
                name="usertype" 
                value="host" 
                class="accent-blue-500"
                <%= oldInput.usertype === 'host' ? 'checked' : '' %> 
              />
              <span>Host</span>
            </label>
          </div>

          <!-- Terms & Conditions -->
          <div class="flex items-center mt-4">
            <input 
              type="checkbox" 
              name="terms" 
              id="terms"
              class="accent-blue-500 mr-2"
              <%= oldInput.terms === 'on' ? 'checked' : '' %>
              required 
            />
            <label for="terms" class="text-gray-700 text-sm">
              I agree to the <a href="/terms" class="text-blue-500 hover:underline">Terms & Conditions</a>
            </label>
          </div>

          <!-- Submit Button -->
          <div class="text-center mt-4">
            <input 
              type="submit" 
              value="Sign Up"
              class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-2.5 rounded-lg hover:opacity-90 transition duration-300 cursor-pointer" 
            />
          </div>

        </form>

        <!-- Bottom Login Redirect -->
        <p class="text-center text-gray-600 text-sm mt-3 md:text-left">
          Already have an account?
          <a href="/login" class="text-blue-500 hover:underline font-semibold">Login</a>
        </p>

      </div>
    </div>
  </main>
</body>
</html>